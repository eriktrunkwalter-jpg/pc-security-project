# SystemIdentityShift.ps1
# Randomizes System Identity artifacts to prevent linking.
# 1. Randomizes Hostname (Computer Name).
# 2. Sets Timezone to UTC (Standard for Anonymity).
# 3. Clears MachineGUID (Tracking ID).

# Self-Elevation
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Start-Process PowerShell -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
    Exit
}

$ErrorActionPreference = "SilentlyContinue"
Clear-Host
Write-Host ">>> SYSTEM IDENTITY SHIFT <<<" -ForegroundColor Cyan

# 1. RANDOMIZE HOSTNAME
$currentName = $env:COMPUTERNAME
$randomName = "DESKTOP-" + -join ((65..90) + (48..57) | Get-Random -Count 7 | ForEach-Object {[char]$_})

Write-Host "[IDENTITY] Current Hostname: $currentName" -ForegroundColor Gray
if ($currentName -ne $randomName) {
    Write-Host "[IDENTITY] Changing Hostname to: $randomName" -ForegroundColor Yellow
    Rename-Computer -NewName $randomName -Force -ErrorAction SilentlyContinue
    Write-Host "   + Hostname change queued (Requires Reboot)." -ForegroundColor Green
} else {
    Write-Host "   + Hostname already randomized." -ForegroundColor Green
}

# 2. SET TIMEZONE TO UTC
Write-Host "[TIME] Setting Timezone to UTC..." -NoNewline
Set-TimeZone -Id "UTC" -ErrorAction SilentlyContinue
Write-Host " Done." -ForegroundColor Green

# 3. ROTATE MACHINE GUID (Registry Tracking ID)
Write-Host "[REGISTRY] Rotating MachineGuid..." -NoNewline
$guidPath = "HKLM:\SOFTWARE\Microsoft\Cryptography"
$newGuid = [Guid]::NewGuid().ToString()
Set-ItemProperty -Path $guidPath -Name "MachineGuid" -Value $newGuid -Force -ErrorAction SilentlyContinue
Write-Host " Done ($newGuid)." -ForegroundColor Green

Write-Host "`n>>> IDENTITY SHIFT COMPLETE <<<" -ForegroundColor Cyan
Write-Host "NOTE: A reboot is required for the Hostname change to take full effect."
Read-Host "Press Enter to exit..."
