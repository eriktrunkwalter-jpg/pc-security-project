# FinalCleanupAndOptimize.ps1
# Final System Optimization & Cleanup Script
# Run as Administrator

Write-Host "=== Starting Final System Optimization ===" -ForegroundColor Cyan

# 1. BitLocker Final Check
Write-Host "Checking BitLocker Status..." -ForegroundColor Yellow
try {
    $bl = Get-BitLockerVolume -MountPoint C:
    Write-Host "Encryption Method: $($bl.EncryptionMethod)"
    Write-Host "Protection Status: $($bl.ProtectionStatus)"
    Write-Host "Percentage Encrypted: $($bl.EncryptionPercentage)%"
    
    if ($bl.EncryptionPercentage -eq 100) {
        Write-Host "SUCCESS: Drive is fully encrypted." -ForegroundColor Green
    } else {
        Write-Host "WARNING: Drive is NOT fully encrypted yet ($($bl.EncryptionPercentage)%)." -ForegroundColor Red
    }
} catch {
    Write-Host "Could not query BitLocker status (Access Denied?). Assuming User Verification." -ForegroundColor DarkGray
}

# 2. SSD Optimization (TRIM)
Write-Host "`nOptimizing SSD (TRIM)..." -ForegroundColor Yellow
try {
    Optimize-Volume -DriveLetter C -ReTrim -Verbose
    Write-Host "SSD Optimization Completed." -ForegroundColor Green
} catch {
    Write-Host "Optimization failed or not supported: $_" -ForegroundColor Red
}

# 3. Cleanup Temporary Files
Write-Host "`nCleaning up Temporary Files..." -ForegroundColor Yellow
$tempFolders = @(
    $env:TEMP,
    "C:\Windows\Temp"
)

foreach ($folder in $tempFolders) {
    if (Test-Path $folder) {
        Get-ChildItem -Path $folder -Recurse -Force -ErrorAction SilentlyContinue | 
            Remove-Item -Force -Recurse -ErrorAction SilentlyContinue
    }
}
Write-Host "Temp files cleaned." -ForegroundColor Green

# 4. Clear Event Logs (Privacy/Anonymity)
Write-Host "`nClearing Event Logs (Privacy)..." -ForegroundColor Yellow
try {
    wevtutil el | ForEach-Object { wevtutil cl "$_" }
    Write-Host "Event Logs Cleared." -ForegroundColor Green
} catch {
    Write-Host "Could not clear all event logs (Admin required)." -ForegroundColor Red
}

# 5. Clear PowerShell History
Write-Host "`nClearing PowerShell History..." -ForegroundColor Yellow
Remove-Item (Get-PSReadlineOption).HistorySavePath -ErrorAction SilentlyContinue
Clear-History
Write-Host "History Cleared." -ForegroundColor Green

Write-Host "`n=== Optimization Complete! System is Ready. ===" -ForegroundColor Cyan
Write-Host "You can now perform a final reboot to ensure all changes (Registry/Policies) are active." -ForegroundColor Cyan
Read-Host "Press Enter to exit..."
