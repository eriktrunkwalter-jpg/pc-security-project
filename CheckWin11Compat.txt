# CheckWin11Compat.ps1
# Checks basic requirements for Windows 11

$LogFile = "$env:USERPROFILE\Documents\trae_projects\pc\Win11_Compat_Report.txt"
Start-Transcript -Path $LogFile -Force

Write-Host ">>> WINDOWS 11 COMPATIBILITY CHECK <<<" -ForegroundColor Cyan

# 1. TPM Check
Write-Host "`n[1] Checking TPM 2.0..." -ForegroundColor Yellow
try {
    $tpm = Get-Tpm
    if ($tpm.TpmPresent) {
        # Check version (WMI)
        $tpmInfo = Get-WmiObject -Namespace "Root\CIMv2\Security\MicrosoftTpm" -Class Win32_Tpm
        $version = $tpmInfo.SpecVersion
        Write-Host "   TPM Present: Yes" -ForegroundColor Green
        Write-Host "   TPM Version: $version"
        if ($version -like "*2.0*") {
            Write-Host "   Result: PASS (TPM 2.0 found)" -ForegroundColor Green
        } else {
            Write-Host "   Result: FAIL (TPM $version found, need 2.0)" -ForegroundColor Red
        }
    } else {
        Write-Host "   Result: FAIL (No TPM found)" -ForegroundColor Red
    }
} catch {
    Write-Host "   Error checking TPM: $_" -ForegroundColor Red
}

# 2. Secure Boot Check
Write-Host "`n[2] Checking Secure Boot..." -ForegroundColor Yellow
try {
    $secureBoot = Confirm-SecureBootUEFI
    if ($secureBoot) {
        Write-Host "   Secure Boot: Enabled" -ForegroundColor Green
        Write-Host "   Result: PASS" -ForegroundColor Green
    } else {
        Write-Host "   Secure Boot: Disabled/Not Supported" -ForegroundColor Red
        Write-Host "   Result: FAIL (Must be enabled in BIOS)" -ForegroundColor Red
    }
} catch {
    Write-Host "   Secure Boot: Unable to determine (Legacy BIOS?)" -ForegroundColor Red
    Write-Host "   Result: FAIL" -ForegroundColor Red
}

# 3. Processor Check
Write-Host "`n[3] Checking Processor..." -ForegroundColor Yellow
$cpu = Get-CimInstance Win32_Processor
Write-Host "   CPU: $($cpu.Name)"
# Simple heuristic - precise list is huge, but we can guess generation
# Intel: 8th Gen+ (e.g. i7-8xxx), AMD: Ryzen 2000+
if ($cpu.Name -match "i\d-(\d{4})") {
    $gen = [int]$matches[1].Substring(0,1)
    # Handle 10th+ gen (5 digits)
    if ($cpu.Name -match "i\d-(\d{5})") { $gen = 10 }
    
    if ($gen -ge 8) {
        Write-Host "   Result: PASS (Intel Gen $gen+ detected)" -ForegroundColor Green
    } else {
        Write-Host "   Result: FAIL (Intel Gen $gen detected, need 8+)" -ForegroundColor Red
    }
} else {
    Write-Host "   Result: MANUAL CHECK REQUIRED (Cannot parse generation easily)" -ForegroundColor Yellow
}

# 4. Storage & RAM
Write-Host "`n[4] Checking RAM & Storage..." -ForegroundColor Yellow
$ram = [math]::Round((Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1GB, 1)
$disk = [math]::Round((Get-CimInstance Win32_LogicalDisk -Filter "DeviceID='C:'").Size / 1GB, 1)

Write-Host "   RAM: $ram GB (Req: 4GB)"
if ($ram -ge 4) { Write-Host "   Result: PASS" -ForegroundColor Green } else { Write-Host "   Result: FAIL" -ForegroundColor Red }

Write-Host "   System Disk: $disk GB (Req: 64GB)"
if ($disk -ge 64) { Write-Host "   Result: PASS" -ForegroundColor Green } else { Write-Host "   Result: FAIL" -ForegroundColor Red }

Stop-Transcript

