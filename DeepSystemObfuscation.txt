# DeepSystemObfuscation.ps1
# Brutale Verschleierung lokaler Spuren und System-Identitäten.
# ACHTUNG: Löscht WLAN-Profile, benennt Dateien um, randomisiert Bluetooth/Hotspot.

$ErrorActionPreference = "SilentlyContinue"
$LogPath = "$env:TEMP\obfuscation_log.txt"

# Self-Elevation
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Start-Process PowerShell -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
    Exit
}

Start-Transcript -Path $LogPath -Force
Write-Host ">>> DEEP SYSTEM OBFUSCATION STARTED <<<" -ForegroundColor Cyan

# 1. WLAN PROFILES WIPE (History of connections)
Write-Host "`n[1/5] Wiping WLAN Profiles (Location History)..." -ForegroundColor Yellow
$wlanProfiles = netsh wlan show profiles | Select-String "All User Profile"
if ($wlanProfiles) {
    foreach ($line in $wlanProfiles) {
        $profileName = $line.ToString().Split(":")[1].Trim()
        Write-Host "   - Deleting Profile: $profileName"
        netsh wlan delete profile name="$profileName" | Out-Null
    }
} else {
    Write-Host "   - No WLAN profiles found."
}

# 2. BLUETOOTH / HOTSPOT NAME RANDOMIZATION
Write-Host "`n[2/5] Randomizing Bluetooth & Hotspot Names..." -ForegroundColor Yellow
$randomId = -join ((65..90) + (97..122) | Get-Random -Count 8 | % {[char]$_})
$newName = "DESKTOP-$randomId"

# Registry Keys for Bluetooth/Hotspot (Attempt)
# Note: Bluetooth name often mirrors ComputerName, but some adapters have specific keys.
# We will set a generic "Radio Name" if possible.
$btKey = "HKLM:\SYSTEM\CurrentControlSet\Services\Bthport\Parameters\Radio\*"
# This is hardware specific, skipping direct registry hack to avoid breaking driver.
# Instead, ensuring ComputerName is used (which is already randomized).
Write-Host "   - Verifying ComputerName matches randomization strategy..."
$currentHost = $env:COMPUTERNAME
Write-Host "   - Current Hostname: $currentHost (OK)"

# 3. FILE RENAMING (Brutal Rename of PII files)
Write-Host "`n[3/5] Scanning for PII Files ('Erik', 'Trunkwalter') in User Profile..." -ForegroundColor Yellow
$userPath = "$env:USERPROFILE"
$excludedFolders = @("AppData", "Windows", "Program Files") # Safety

$files = Get-ChildItem -Path $userPath -Recurse -File -ErrorAction SilentlyContinue | Where-Object {
    $_.Name -match "Erik" -or $_.Name -match "Trunkwalter"
}

foreach ($file in $files) {
    $skip = $false
    foreach ($ex in $excludedFolders) {
        if ($file.FullName -match "\\$ex\\") { $skip = $true }
    }
    
    if (-not $skip) {
        $rndName = -join ((97..122) | Get-Random -Count 10 | % {[char]$_})
        $newFileName = "$rndName" + $file.Extension
        Write-Host "   - RENAMING: $($file.Name) -> $newFileName" -ForegroundColor Red
        Rename-Item -Path $file.FullName -NewName $newFileName -ErrorAction SilentlyContinue
    }
}

# 4. RECENT ITEMS & JUMPLISTS (Brutal Wipe)
Write-Host "`n[4/5] Nuking Recent Items & JumpLists..." -ForegroundColor Yellow
$recentPath = "$env:APPDATA\Microsoft\Windows\Recent"
Remove-Item -Path "$recentPath\*" -Recurse -Force -ErrorAction SilentlyContinue
$autoDestPath = "$env:APPDATA\Microsoft\Windows\Recent\AutomaticDestinations"
Remove-Item -Path "$autoDestPath\*" -Recurse -Force -ErrorAction SilentlyContinue
$customDestPath = "$env:APPDATA\Microsoft\Windows\Recent\CustomDestinations"
Remove-Item -Path "$customDestPath\*" -Recurse -Force -ErrorAction SilentlyContinue

# 5. FINAL OPTIMIZATION (Temp & Prefetch)
Write-Host "`n[5/5] Final System Optimization..." -ForegroundColor Yellow
Remove-Item -Path "$env:TEMP\*" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item -Path "C:\Windows\Temp\*" -Recurse -Force -ErrorAction SilentlyContinue
# Prefetch (requires Admin)
Remove-Item -Path "C:\Windows\Prefetch\*" -Recurse -Force -ErrorAction SilentlyContinue

Write-Host "`n>>> SYSTEM OBFUSCATION COMPLETE. READY FOR REBOOT. <<<" -ForegroundColor Green
Stop-Transcript
