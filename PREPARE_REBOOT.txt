# PREPARE_REBOOT.ps1
# Final Cleanup and Prep

$ProjectDir = "$env:USERPROFILE\Documents\trae_projects\pc"
$BackupDir = "$env:USERPROFILE\Documents\trae_projects\pc\Scripts_Backup"
$LogsDir = "$env:USERPROFILE\Documents\trae_projects\pc\Logs"

# Create directories
if (-not (Test-Path $BackupDir)) { New-Item -Path $BackupDir -ItemType Directory | Out-Null }
if (-not (Test-Path $LogsDir)) { New-Item -Path $LogsDir -ItemType Directory | Out-Null }

Write-Host ">>> STARTING CLEANUP <<<" -ForegroundColor Cyan

# Move scripts (Keep ForceEncryption.ps1 and PREPARE_REBOOT.ps1 for now)
$FilesToMove = Get-ChildItem -Path $ProjectDir -File | Where-Object { 
    $_.Name -like "*.ps1" -and 
    $_.Name -ne "ForceEncryption.ps1" -and 
    $_.Name -ne "PREPARE_REBOOT.ps1" -and
    $_.Name -ne "SecureKeyVault.ps1" 
}

foreach ($file in $FilesToMove) {
    Write-Host "Archiving $($file.Name)..."
    Move-Item -Path $file.FullName -Destination $BackupDir -Force
}

# Move Logs/Reports
$Reports = Get-ChildItem -Path $ProjectDir -File | Where-Object { $_.Name -like "*.md" -or $_.Name -like "*.txt" }
foreach ($file in $Reports) {
    Write-Host "Archiving $($file.Name)..."
    Move-Item -Path $file.FullName -Destination $LogsDir -Force
}

Write-Host "Cleanup Complete." -ForegroundColor Green
Write-Host "System is ready for reboot."

