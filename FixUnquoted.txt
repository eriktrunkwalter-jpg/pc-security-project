# FixUnquoted.ps1
# Fixes Unquoted Service Path for asComSvc (ASUS)
# Requires Admin

# Self-Elevation
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Start-Process PowerShell -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
    Exit
}

$serviceName = "asComSvc"
$service = Get-WmiObject Win32_Service -Filter "Name='$serviceName'"

if ($service) {
    $currentPath = $service.PathName
    Write-Host "Current Path: $currentPath"
    
    if ($currentPath -notmatch '^"') {
        $newPath = "`"$currentPath`""
        Write-Host "New Path: $newPath"
        
        # Method 1: Registry (More reliable for changing ImagePath)
        $regPath = "HKLM:\SYSTEM\CurrentControlSet\Services\$serviceName"
        Set-ItemProperty -Path $regPath -Name "ImagePath" -Value $newPath
        Write-Host "Registry updated." -ForegroundColor Green
    } else {
        Write-Host "Already quoted."
    }
} else {
    Write-Host "Service $serviceName not found."
}

# Cleanup Recent again
Remove-Item "$env:APPDATA\Microsoft\Windows\Recent\*" -Force -Recurse -ErrorAction SilentlyContinue

Write-Host "Fix Complete."
Start-Sleep -Seconds 2
