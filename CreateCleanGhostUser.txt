# CreateCleanGhostUser.ps1
# Creates a pristine Administrator account "Ghost" to eliminate "Erik" artifacts.
# Copies security tools to a shared location (C:\GhostSec).

if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Start-Process PowerShell -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
    Exit
}

$ErrorActionPreference = "SilentlyContinue"
$newUserName = "Ghost"
$password = "GhostSecure123!" # User should change this immediately
$sharedDir = "C:\GhostSec"

Write-Host ">>> CREATING CLEAN GHOST IDENTITY <<<" -ForegroundColor Cyan

# 1. Create Shared Tool Directory
Write-Host "   + Creating Shared Security Vault ($sharedDir)..." -NoNewline
New-Item -Path $sharedDir -ItemType Directory -Force | Out-Null
Copy-Item -Path "$env:USERPROFILE\Documents\trae_projects\pc\*.ps1" -Destination $sharedDir -Force
Write-Host " Done." -ForegroundColor Green

# 2. Create New User
Write-Host "   + Creating New User '$newUserName'..." -NoNewline
$userCheck = Get-LocalUser -Name $newUserName -ErrorAction SilentlyContinue
if (!$userCheck) {
    # Net User command is reliable
    net user $newUserName $password /add /active:yes /expires:never | Out-Null
    net localgroup Administrators $newUserName /add | Out-Null
    Write-Host " Created." -ForegroundColor Green
    Write-Host "   ! DEFAULT PASSWORD: $password (CHANGE IMMEDIATELY)" -ForegroundColor Yellow
} else {
    Write-Host " Exists." -ForegroundColor Yellow
}

# 3. Hide "Erik" from Login Screen (Optional - uncomment to enable)
# Write-Host "   + Hiding old account 'Erik' from login..."
# New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -Name "Erik" -Value 0 -PropertyType DWord -Force

Write-Host "`n>>> GHOST USER READY <<<" -ForegroundColor Green
Write-Host "1. Log out of 'Erik'."
Write-Host "2. Log in as 'Ghost'."
Write-Host "3. Run 'C:\GhostSec\InstallGhostProtocols.ps1' again to lock the new profile."
Write-Host "4. Delete 'Erik' account later for total cleanup."
