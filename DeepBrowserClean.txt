# DeepBrowserClean.ps1
# Wipes Cookies, Cache, History, and Sessions for Edge, Chrome, Firefox, Brave.
# Enforces "No Logins" state.

$ErrorActionPreference = "SilentlyContinue"
Write-Host ">>> DEEP CLEANING BROWSERS (FORCE LOGOUT) <<<" -ForegroundColor Cyan

# Close Browsers First
Write-Host "Closing running browsers..." -ForegroundColor Yellow
Stop-Process -Name "msedge" -Force
Stop-Process -Name "chrome" -Force
Stop-Process -Name "firefox" -Force
Stop-Process -Name "brave" -Force
Start-Sleep -Seconds 2

# 1. CHROME & BRAVE & EDGE (Chromium Based)
$userPath = "$env:LOCALAPPDATA"
$chromiumPaths = @(
    "$userPath\Google\Chrome\User Data\Default",
    "$userPath\Microsoft\Edge\User Data\Default",
    "$userPath\BraveSoftware\Brave-Browser\User Data\Default"
)

foreach ($path in $chromiumPaths) {
    if (Test-Path $path) {
        Write-Host "Cleaning: $path" -ForegroundColor Gray
        Remove-Item "$path\Cookies" -Force
        Remove-Item "$path\Cookies-journal" -Force
        Remove-Item "$path\History" -Force
        Remove-Item "$path\History-journal" -Force
        Remove-Item "$path\Login Data" -Force
        Remove-Item "$path\Login Data-journal" -Force
        Remove-Item "$path\Web Data" -Force
        Remove-Item "$path\Web Data-journal" -Force
        Remove-Item "$path\Cache" -Recurse -Force
        Remove-Item "$path\Code Cache" -Recurse -Force
        Remove-Item "$path\Sessions" -Recurse -Force
        Remove-Item "$path\Session Storage" -Recurse -Force
        Remove-Item "$path\Local Storage" -Recurse -Force
    }
}

# 2. FIREFOX
$ffBase = "$env:APPDATA\Mozilla\Firefox\Profiles"
if (Test-Path $ffBase) {
    $profiles = Get-ChildItem $ffBase
    foreach ($profile in $profiles) {
        Write-Host "Cleaning Firefox Profile: $($profile.Name)" -ForegroundColor Gray
        $pPath = $profile.FullName
        Remove-Item "$pPath\cookies.sqlite" -Force
        Remove-Item "$pPath\places.sqlite" -Force # History
        Remove-Item "$pPath\formhistory.sqlite" -Force
        Remove-Item "$pPath\key4.db" -Force # Passwords (Key DB)
        Remove-Item "$pPath\logins.json" -Force # Passwords
        Remove-Item "$pPath\sessionstore.jsonlz4" -Force
        Remove-Item "$pPath\sessionstore-backups" -Recurse -Force
        
        # Cache is in LocalAppData
        $ffCache = "$env:LOCALAPPDATA\Mozilla\Firefox\Profiles\$($profile.Name)"
        if (Test-Path $ffCache) {
            Remove-Item "$ffCache\cache2" -Recurse -Force
            Remove-Item "$ffCache\startupCache" -Recurse -Force
        }
    }
}

Write-Host "`n>>> BROWSER DATA WIPED <<<" -ForegroundColor Green
Write-Host "You are now logged out of EVERYTHING."
Read-Host "Press Enter to exit..."
