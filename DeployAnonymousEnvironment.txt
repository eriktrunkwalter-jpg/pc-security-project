# DeployAnonymousEnvironment.ps1
# Deploys Tor Browser and creates a 'GHOST ACCESS' shortcut.
# This ensures the user uses the CORRECT tool for anonymity.

# Self-Elevation
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Start-Process PowerShell -Verb RunAs "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
    Exit
}

$ErrorActionPreference = "SilentlyContinue"
Write-Host ">>> DEPLOYING ANONYMOUS ENVIRONMENT <<<" -ForegroundColor Cyan

# 1. INSTALL TOR BROWSER (If not present)
$tbPath = "C:\Program Files\Tor Browser\Browser\firefox.exe" # Typical path
if (!(Test-Path $tbPath)) {
    # Check User Path
    $tbPathUser = "$env:USERPROFILE\Desktop\Tor Browser\Browser\firefox.exe"
    if (Test-Path $tbPathUser) {
        $tbPath = $tbPathUser
    } else {
        Write-Host "[DEPLOY] Tor Browser not found. Installing via Winget..." -ForegroundColor Yellow
        winget install TorProject.TorBrowser -e --accept-source agreements --accept-package-agreements
        
        # Winget install path varies. Let's look for it.
        Start-Sleep -Seconds 10
        $tbPath = Get-ChildItem -Path "C:\Program Files" -Filter "firefox.exe" -Recurse -ErrorAction SilentlyContinue | Where-Object { $_.FullName -like "*Tor Browser*" } | Select-Object -First 1 -ExpandProperty FullName
    }
}

if ($tbPath -and (Test-Path $tbPath)) {
    Write-Host "[DEPLOY] Tor Browser located at: $tbPath" -ForegroundColor Green
    
    # 2. CREATE SHORTCUT 'GHOST ACCESS'
    $WshShell = New-Object -ComObject WScript.Shell
    $Shortcut = $WshShell.CreateShortcut("$env:USERPROFILE\Desktop\GHOST ACCESS.lnk")
    $Shortcut.TargetPath = $tbPath
    $Shortcut.IconLocation = "$tbPath,0"
    $Shortcut.Description = "Launch Anonymous Browser (Tor)"
    $Shortcut.Save()
    
    Write-Host "[DEPLOY] 'GHOST ACCESS' Shortcut created on Desktop." -ForegroundColor Green
} else {
    Write-Host "[ERROR] Could not verify Tor Browser installation. Please install manually from torproject.org" -ForegroundColor Red
}

Write-Host "`n>>> DEPLOYMENT COMPLETE <<<" -ForegroundColor Cyan
Read-Host "Press Enter to exit..."
